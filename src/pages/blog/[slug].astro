---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const formattedDate = entry.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const ogImage = new URL('/og-image.jpg', Astro.site);

const articleSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": entry.data.title,
  "description": entry.data.description,
  "datePublished": entry.data.date.toISOString(),
  "url": canonicalURL.toString(),
  "image": ogImage.toString(),
  "author": {
    "@type": "Person",
    "name": entry.data.author ?? "Ross Starkey",
    "url": "https://rossstarkey.com"
  },
  "publisher": {
    "@type": "Person",
    "name": "Ross Starkey",
    "url": "https://rossstarkey.com"
  }
};
---

<Layout title={`${entry.data.title} - Ross Starkey`} description={entry.data.description}>
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} slot="head" />

  <article class="max-w-4xl mx-auto px-6 py-16">
    <!-- Back link -->
    <a
      href="/blog"
      class="inline-flex items-center gap-2 text-teal-400 hover:text-teal-300 mb-8 font-medium"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to Blog
    </a>

    <!-- Article header -->
    <header class="mb-12">
      <div class="flex items-center gap-3 text-sm">
        <time class="text-teal-400 font-medium">{formattedDate}</time>
        {entry.data.author && (
          <>
            <span class="text-gray-600">Â·</span>
            <span class="text-gray-400">{entry.data.author}</span>
          </>
        )}
      </div>
      <h1 class="text-4xl md:text-5xl font-bold text-white mt-4 mb-6">
        {entry.data.title}
      </h1>
      <p class="text-xl text-gray-400 leading-relaxed">
        {entry.data.description}
      </p>
      {entry.data.tags && entry.data.tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-6">
          {entry.data.tags.map((tag: string) => (
            <span class="px-3 py-1 bg-teal-500/10 text-teal-400 text-sm rounded-full">
              {tag}
            </span>
          ))}
        </div>
      )}
    </header>

    <!-- Article content -->
    <div class="prose prose-lg prose-invert max-w-none
      prose-headings:font-bold prose-headings:text-white
      prose-h1:text-4xl prose-h2:text-3xl prose-h3:text-2xl
      prose-p:text-gray-300 prose-p:leading-relaxed
      prose-a:text-teal-400 prose-a:no-underline hover:prose-a:text-teal-300
      prose-strong:text-white
      prose-code:text-teal-400 prose-code:bg-gray-800 prose-code:px-1 prose-code:py-0.5 prose-code:rounded
      prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:border prose-pre:border-gray-800
      prose-ul:text-gray-300 prose-ol:text-gray-300
      prose-li:text-gray-300
      prose-blockquote:border-teal-500 prose-blockquote:text-gray-400
    ">
      <Content />
    </div>

    <!-- Article footer -->
    <footer class="mt-16 pt-8 border-t border-gray-800">
      <a
        href="/blog"
        class="inline-flex items-center gap-2 text-teal-400 hover:text-teal-300 font-medium"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Blog
      </a>
    </footer>
  </article>
</Layout>
